<head>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css" />
</head>
<%- include('partials/userheader.ejs') %> 
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<main class="main">
	<div class="page-header text-center" style="background-image: url('assets/images/page-header-bg.jpg')">
		<div class="container">
			<h1 class="page-title">Shopping Cart<span>Shop</span></h1>
		</div><!-- End .container -->
	</div><!-- End .page-header -->
	<nav aria-label="breadcrumb" class="breadcrumb-nav">
		<div class="container">
			<ol class="breadcrumb">
				<li class="breadcrumb-item"><a href="index.html">Home</a></li>
				<li class="breadcrumb-item"><a href="#">Shop</a></li>
				<li class="breadcrumb-item active" aria-current="page">Shopping Cart</li>
			</ol>
		</div><!-- End .container -->
	</nav><!-- End .breadcrumb-nav -->
<% if (cartList==null || cart.cart.length == 0) { %>
 <h1>Empty</h1>
 <% } else { %>
  
	<div class="page-content">
		<div class="cart">
			<div class="container">
			
				 
				
				<div class="row">
					<div class="col-lg-9">
						<table class="table table-cart table-mobile">
							<thead>
								<tr>
									<th>Product</th>
									<th>Price</th>
									<th>Quantity</th>
									<th>Total</th>
									<th></th>
								</tr>
							</thead>
					
							<tbody>
<% cartList.forEach(cart => { %>
	<tr>
		<td class="product-col">
			<div class="product">
				<figure class="product-media">
					<a href="#">
						<img src="/product-images/<%=cart.product_id.imagesDetails[0].filename %> " alt="Product image">
					</a>
				</figure>

				<h3 class="product-title">
					<a href="#"><%= cart.product_id.brandname.brandName %> </a>
				</h3>
				
				<!-- E
					<!End .product-title -->
			</div><!-- End .product -->
		</td>
		<td class="price-col">$<%= cart.product_id.price %>

		</td>
		<td class="quantity-col">
			<div class="cart-product-quantity d-flex">
				 <i class="bi bi-caret-left"
				 onclick="incQuantity(`<%=cart.product_id._id %>`)"></i>
		   <input type="text" id="quantityBox<%=cart.product_id._id %>" class="form-control" value="<%=cart.quantity%>">
		   <i class="bi bi-caret-right"
		    onclick="decQuantity(`<%=cart.product_id._id %>`)"></i>
			
			

			

			
		   
		   
		   
		   
			</div><!-- End .cart-product-quantity -->
		</td>
		<td class="total-col"id="totalBoxx<%=cart.product_id._id %>">$<%=cart.total%> </td>
		<td class="remove-col"><button onclick="deleteProduct('<%=cart.product_id._id %>')"class="btn-primary"><i class="icon-close"></i></button></td>
	</tr>
<% }) %>
</tbody>
</table><!-- End .table table-wishlist -->

<div class="cart-bottom">
	<div class="cart-discount">
		<form>
			<div class="input-group">
				<input type="text" class="form-control" id="resultCode" required placeholder="coupon code" value="">
				<div class="input-group-append">
					<button class="btn btn-outline-primary-2" type="submit"><i class="icon-long-arrow-right"></i></button>
				</div><!-- .End .input-group-append -->
				
			</div><!-- End .input-group -->
			<div class="card-body">
				<div class="form-group">
					<p>applicable coupons</p>
					
		



				</div>

			</div>


			
		</form>
	</div><!-- End .cart-discount -->

	<a href="#" class="btn btn-outline-dark-2"><span>UPDATE CART</span><i class="icon-refresh"></i></a>
</div><!-- End .cart-bottom -->
</div><!-- End .col-lg-9 -->
<aside class="col-lg-3">
<div class="summary summary-cart">
	<h3 class="summary-title">Cart Total</h3><!-- End .summary-title -->

	<table class="table table-summary">
		<tbody>
			<tr class="summary-subtotal">
				<td>Subtotal:</td>
				<td id="cartTotal"><%= cart.subTotal %> </td>
			</tr><!-- End .summary-subtotal -->
			<tr class="summary-shipping">
				
				<td>&nbsp;</td>
			</tr>

			<tr class="summary-shipping-row">
				<td>
					<div class="custom-control custom-radio">
						<input type="radio" id="free-shipping" name="shipping" class="custom-control-input">
						<label class="custom-control-label" for="free-shipping">Free Shipping</label>
					</div><!-- End .custom-control -->
				</td>
				<td>$0.00</td>
			</tr><!-- End .summary-shipping-row -->

			<tr class="summary-shipping-row">
				<td>
					<div class="custom-control custom-radio">
						
						
					</div><!-- End .custom-control -->
				</td>
				
			</tr><!-- End .summary-shipping-row -->

			<tr class="summary-shipping-row">
				<td>
					
				</td>
				
			</tr><!-- End .summary-shipping-row -->

			<tr class="summary-shipping-estimate">
				<td>Estimate for Your Country<br> <a href="dashboard.html">Change address</a></td>
				<td>&nbsp;</td>
			</tr><!-- End .summary-shipping-estimate -->

			<tr class="summary-total">
				<td>Total:</td>
				<span  id="sub"><%= cart.subTotal %> </span>
			</tr><!-- End .summary-total -->
		</tbody>
	</table><!-- End .table table-summary -->
	
	<button onclick="checkOut()" id="confirmbutton" class="btn btn-outline-primary-2 btn-order btn-block" style="cursor: pointer;">Proceed to checkout</button>
</div><!-- End .summary -->

<a href="/shop" class="btn btn-outline-dark-2 btn-block mb-3"><span>CONTINUE SHOPPING</span><i class="icon-refresh"></i></a>
</aside><!-- End .col-lg-3 -->
</div><!-- End .row -->
</div><!-- End .container -->
<% } %>

					
						
		</div><!-- End .cart -->
	</div><!-- End .page-content -->
</main><!-- End .main -->


<!-- Plugins JS File -->
<script src="assets/js/jquery.min.js"></script>
<script src="assets/js/bootstrap.bundle.min.js"></script>
<script src="assets/js/jquery.hoverIntent.min.js"></script>
<script src="assets/js/jquery.waypoints.min.js"></script>
<script src="assets/js/superfish.min.js"></script>
<script src="assets/js/owl.carousel.min.js"></script>
<script src="assets/js/bootstrap-input-spinner.js"></script>
<!-- Main JS File -->
<script src="assets/js/main.js"></script>
</body>


  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>


<!-- molla/cart.html  22 Nov 2019 09:55:06 GMT -->
<script>
		const incQuantity = (id) => {	
		    axios.patch("/quantityInc", { id: id }).then((e) => {
      if (e.data.response) {
		document.getElementById("quantityBox" + id).value = e.data.quantity;
		document.getElementById('sub').innerHTML = e.data.subtotal;
		document.getElementById('cartTotal').innerHTML = e.data.subtotal;
		document.getElementById('totalBoxx' + id).innerHTML = e.data.total;

      }
    }).catch((err)=>{console.log(err.message)})
  
};


function checkOut() {
    location.href = "/checkout"
  }
		
const decQuantity = (id) => {	



axios.patch("/quantityDec", { id: id }).then((e) => {
if (e.data.response) {
	
document.getElementById("quantityBox" + id).value = e.data.quantity;
document.getElementById('sub').innerHTML = e.data.subtotal;
		document.getElementById('cartTotal').innerHTML = e.data.subtotal;
		document.getElementById('totalBoxx' + id).innerHTML = e.data.total;
}
}).catch((err)=>{console.log(err.message)})

};


const deleteProduct = (id) => {
      axios.delete("/deleteCartProduct", { data: { id: id } }).then((e) => {
        if (e.data.response) {
          const Toast = Swal.mixin({
            toast: true,
            position: "top-end",
            showConfirmButton: false,
            timer: 3000,
            timerProgressBar: true,
            didOpen: (toast) => {
              toast.addEventListener("mouseenter", Swal.stopTimer);
              toast.addEventListener("mouseleave", Swal.resumeTimer);
            },
          });

          Toast.fire({
            icon: "success",
            title: "Saved to wishlist",
          });
          location.href = "/cart";
        }
      });
    }
 
</script>
</html>
<%- include('partials/userfooter.ejs') %>
      
